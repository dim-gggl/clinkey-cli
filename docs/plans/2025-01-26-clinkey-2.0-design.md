# Clinkey CLI 2.0.0 - Comprehensive Design Document

**Date:** 2025-01-26
**Version:** 2.0.0
**Status:** Design Phase - Approved
**Authors:** Clinkey Development Team

---

## Table of Contents

1. [Executive Summary](#executive-summary)
2. [Vision and Core Principles](#vision-and-core-principles)
3. [Architecture Overview](#architecture-overview)
4. [Security Analysis Engine](#security-analysis-engine)
5. [Enhanced Generation System](#enhanced-generation-system)
6. [Password Vault](#password-vault)
7. [Textual TUI Layer](#textual-tui-layer)
8. [CLI Command Structure](#cli-command-structure)
9. [Configuration System](#configuration-system)
10. [Data Models and Database Schema](#data-models-and-database-schema)
11. [Security Implementation Specifics](#security-implementation-specifics)
12. [Dependencies and Technology Stack](#dependencies-and-technology-stack)
13. [Testing Strategy](#testing-strategy)
14. [Migration and Upgrade Path](#migration-and-upgrade-path)
15. [Implementation Phasing](#implementation-phasing)
16. [Documentation Plan](#documentation-plan)
17. [Release Strategy](#release-strategy)
18. [Future Considerations](#future-considerations)

---

## Executive Summary

Clinkey CLI 2.0.0 transforms clinkey from a password generator into a comprehensive password security suite. This major version adds:

- **Advanced Security Analysis**: Entropy calculation, pattern detection, breach checking, NIST/OWASP compliance validation
- **Extended Generation Capabilities**: Passphrases, pattern-based generation, multi-language support
- **Password Vault**: Secure local storage with full password management
- **Enhanced TUI**: Modern terminal interface built with Textual framework

**Critical Constraint**: 100% backward compatibility with 1.x - all existing commands work identically.

---

## Vision and Core Principles

### Vision

Transform clinkey from a password generator into a comprehensive password security suite, built on advanced security analysis, versatile generation capabilities, and an enhanced terminal UI - all while maintaining 100% backward compatibility with 1.x.

### Core Principles

1. **Security First**: Every generated password gets analyzed with advanced security metrics
2. **Backward Compatible**: All existing commands work identically; new features are purely additive
3. **CLI Native**: Terminal-first philosophy with modern TUI enhancements via Textual
4. **Zero Breaking Changes**: Existing scripts, workflows, and API calls continue to work

### Design Philosophy

The three pillars of 2.0, prioritized in order:

1. **Security First** - Build strong security/compliance foundation
2. **Enhanced Capabilities** - Expand generation features on top of security base
3. **User Experience Evolution** - Enhanced CLI with TUI for improved interaction

---

## Architecture Overview

The 2.0 architecture maintains the current structure but adds four major subsystems:

### Module Structure

```
clinkey-cli/
â”œâ”€â”€ clinkey_cli/
â”‚   â”œâ”€â”€ __init__.py                 # Package initialization
â”‚   â”œâ”€â”€ main.py                     # Legacy Clinkey class (backward compat)
â”‚   â”œâ”€â”€ cli.py                      # CLI interface (Click + Rich)
â”‚   â”‚
â”‚   â”œâ”€â”€ security/                   # NEW: Security Analysis Engine
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ entropy.py              # Entropy calculation
â”‚   â”‚   â”œâ”€â”€ patterns.py             # Pattern detection
â”‚   â”‚   â”œâ”€â”€ dictionary.py           # Dictionary analysis
â”‚   â”‚   â”œâ”€â”€ breach.py               # Breach database checking
â”‚   â”‚   â”œâ”€â”€ context.py              # zxcvbn-style context analysis
â”‚   â”‚   â””â”€â”€ compliance.py           # NIST/OWASP validation
â”‚   â”‚
â”‚   â”œâ”€â”€ generators/                 # NEW: Enhanced Generation System
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py                 # Abstract base generator
â”‚   â”‚   â”œâ”€â”€ syllable.py             # Refactored current generator
â”‚   â”‚   â”œâ”€â”€ passphrase.py           # Diceware-style passphrases
â”‚   â”‚   â”œâ”€â”€ pattern.py              # Pattern-based generation
â”‚   â”‚   â””â”€â”€ registry.py             # Generator management
â”‚   â”‚
â”‚   â”œâ”€â”€ vault/                      # NEW: Password Vault
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ storage.py              # Encrypted SQLite storage
â”‚   â”‚   â”œâ”€â”€ models.py               # Data models
â”‚   â”‚   â”œâ”€â”€ operations.py           # CRUD operations
â”‚   â”‚   â”œâ”€â”€ categories.py           # Category management
â”‚   â”‚   â”œâ”€â”€ io.py                   # Import/export
â”‚   â”‚   â””â”€â”€ cli.py                  # Vault CLI commands
â”‚   â”‚
â”‚   â”œâ”€â”€ tui/                        # NEW: Textual TUI Layer
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ vault_browser.py        # Vault TUI interface
â”‚   â”‚   â”œâ”€â”€ generator.py            # Interactive generator
â”‚   â”‚   â”œâ”€â”€ analyzer.py             # Strength analyzer display
â”‚   â”‚   â”œâ”€â”€ templates.py            # Template designer
â”‚   â”‚   â”œâ”€â”€ dashboard.py            # Main TUI dashboard
â”‚   â”‚   â””â”€â”€ widgets.py              # Reusable components
â”‚   â”‚
â”‚   â””â”€â”€ config/                     # NEW: Configuration System
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ manager.py              # Config file handling
â”‚
â”œâ”€â”€ tests/                          # Expanded test suite
â”œâ”€â”€ docs/                           # NEW: Comprehensive documentation
â”œâ”€â”€ Formula/                        # Homebrew formula
â””â”€â”€ pyproject.toml                  # Updated dependencies
```

### Subsystem Overview

1. **Security Analysis Engine** (`clinkey_cli/security/`)
   - Entropy calculation, pattern detection, breach checking
   - NIST compliance validation, zxcvbn-style context-aware analysis

2. **Enhanced Generation System** (`clinkey_cli/generators/`)
   - Current syllable-based generator plus
   - Passphrase generator, pattern-based generator
   - Multi-language syllable sets

3. **Password Vault** (`clinkey_cli/vault/`)
   - Encrypted local storage, full password management
   - Categories, history, import/export capabilities

4. **Textual TUI Layer** (`clinkey_cli/tui/`)
   - Interactive interfaces: vault browser, template designer
   - Real-time strength meter, interactive password management

---

## Security Analysis Engine

### Module Structure: `clinkey_cli/security/`

This engine analyzes any password (generated or user-provided) and produces comprehensive security metrics.

### Core Components

#### 1. Entropy Calculator (`entropy.py`)

**Purpose**: Calculates Shannon entropy and effective entropy based on character set size and length.

**Functionality**:
- Shannon entropy: `H = -Î£(p(x) * logâ‚‚(p(x)))`
- Character set entropy: `logâ‚‚(charset_size^length)`
- Bits-of-entropy scoring used by all other security metrics

**API**:
```python
def calculate_shannon_entropy(password: str) -> float:
    """Calculate Shannon entropy in bits."""

def calculate_charset_entropy(password: str, length: int) -> float:
    """Calculate theoretical entropy based on character set."""

def get_entropy_score(password: str) -> dict:
    """Return comprehensive entropy analysis."""
```

#### 2. Pattern Detector (`patterns.py`)

**Purpose**: Identifies security-weakening patterns.

**Patterns Detected**:
- Keyboard walks (qwerty, asdfgh, etc.)
- Sequential characters (abc, 123, etc.)
- Repeated sequences (aaa, 111111)
- Common substitutions (@ for a, 3 for e)
- Visual patterns (dates, phone formats)

**API**:
```python
def detect_keyboard_walks(password: str) -> list[dict]:
    """Detect keyboard walk patterns."""

def detect_sequences(password: str) -> list[dict]:
    """Detect sequential character patterns."""

def detect_repetitions(password: str) -> list[dict]:
    """Detect repeated character/sequence patterns."""

def analyze_patterns(password: str) -> dict:
    """Comprehensive pattern analysis."""
```

#### 3. Dictionary Analyzer (`dictionary.py`)

**Purpose**: Checks against common password lists.

**Features**:
- Checks against common password lists (top 10k, 100k, 1M)
- Case-insensitive matching
- Leetspeak variation detection
- Dictionary words embedded in passwords

**Word Lists**:
- Top 10,000 most common passwords
- Top 100,000 passwords
- Top 1,000,000 passwords
- Common English dictionary

**API**:
```python
def check_common_passwords(password: str) -> dict:
    """Check against common password lists."""

def find_dictionary_words(password: str) -> list[str]:
    """Find dictionary words in password."""

def check_leetspeak(password: str) -> dict:
    """Check for leetspeak variations."""
```

#### 4. Breach Database Checker (`breach.py`)

**Purpose**: Check if password appears in known data breaches.

**Implementation**:
- Uses k-anonymity model (like HaveIBeenPwned)
- Sends only first 5 chars of SHA-1 hash
- Offline mode with local breach database option
- Respects privacy while checking compromise status

**API**:
```python
async def check_breach_online(password: str) -> dict:
    """Check breach database online (k-anonymity)."""

def check_breach_offline(password: str, db_path: str) -> dict:
    """Check local breach database."""

async def check_breach(password: str, offline: bool = False) -> dict:
    """Check breach status (online or offline)."""
```

#### 5. Context Analyzer (`context.py`)

**Purpose**: zxcvbn-inspired analysis considering password structure context.

**Features**:
- Evaluates attack scenarios (brute force, dictionary, pattern-based)
- Estimates crack time across different attacker resources:
  - Online throttled (100/hour)
  - Offline slow hash (10k/sec)
  - Offline fast hash (10B/sec)
- Contextual strength assessment

**API**:
```python
def analyze_context(password: str) -> dict:
    """Context-aware password analysis."""

def estimate_crack_time(password: str, scenario: str) -> dict:
    """Estimate time to crack under different scenarios."""

def get_attack_vector_analysis(password: str) -> dict:
    """Analyze likely attack vectors."""
```

#### 6. Compliance Validator (`compliance.py`)

**Purpose**: Validate against security standards.

**Standards**:
- NIST SP 800-63B validation
- OWASP ASVS password requirements
- Configurable policy rules
- Generates compliance reports

**API**:
```python
def validate_nist(password: str) -> dict:
    """Validate NIST SP 800-63B compliance."""

def validate_owasp(password: str) -> dict:
    """Validate OWASP ASVS requirements."""

def validate_custom_policy(password: str, policy: dict) -> dict:
    """Validate against custom policy."""

def generate_compliance_report(password: str) -> dict:
    """Comprehensive compliance report."""
```

### Security Engine Integration

All components integrate into a unified analysis API:

```python
from clinkey_cli.security import analyze_password

result = analyze_password("MyPassword123", check_breach=True)
# Returns:
# {
#     "entropy": {...},
#     "patterns": {...},
#     "dictionary": {...},
#     "breach": {...},
#     "context": {...},
#     "compliance": {...},
#     "strength_score": 0-100,
#     "strength_label": "Weak|Moderate|Strong|Very Strong",
#     "recommendations": [...]
# }
```

---

## Enhanced Generation System

### Module Structure: `clinkey_cli/generators/`

This refactors the current generation logic and adds new generation methods while maintaining backward compatibility.

### Core Components

#### 1. Base Generator (`base.py`)

**Purpose**: Abstract base class defining generator interface.

**Functionality**:
- Abstract base class for all generators
- Common utilities for length fitting
- Character transformation methods
- Ensures consistent API across all generator types

**API**:
```python
from abc import ABC, abstractmethod

class BaseGenerator(ABC):
    """Abstract base class for all password generators."""

    @abstractmethod
    def generate(self, length: int, **kwargs) -> str:
        """Generate a password of specified length."""
        pass

    def fit_to_length(self, password: str, target_length: int) -> str:
        """Fit password to target length."""
        pass

    def transform(self, password: str, lower: bool = False,
                  no_separator: bool = False) -> str:
        """Apply transformations to password."""
        pass
```

#### 2. Syllable Generator (`syllable.py`)

**Purpose**: Refactored version of current Clinkey class.

**Features**:
- Preserves all existing behavior (normal, strong, super_strong)
- Enhanced with multi-language syllable sets
- Configurable syllable complexity
- Maintains exact backward compatibility with 1.x output when using default settings

**Languages**:
- English (default)
- French
- Spanish
- German
- Italian
- Japanese (romanji)

**API**:
```python
class SyllableGenerator(BaseGenerator):
    """Syllable-based password generator."""

    def __init__(self, language: str = "english"):
        """Initialize with specified language."""

    def generate(self, length: int, type: str = "normal",
                 lower: bool = False, no_separator: bool = False,
                 separator: str | None = None) -> str:
        """Generate syllable-based password."""

    def normal(self) -> str:
        """Letters + separators (backward compatible)."""

    def strong(self) -> str:
        """Letters + digits + separators (backward compatible)."""

    def super_strong(self) -> str:
        """Letters + digits + specials + separators (backward compatible)."""
```

#### 3. Passphrase Generator (`passphrase.py`)

**Purpose**: Diceware-style word-based passwords.

**Features**:
- Built-in word lists:
  - EFF long list (7,776 words)
  - EFF short list (1,296 words)
- Custom word list support
- Configurable word count (3-10 words)
- Customizable separators or camelCase
- Supports multiple languages

**API**:
```python
class PassphraseGenerator(BaseGenerator):
    """Word-based passphrase generator."""

    def __init__(self, wordlist: str = "eff_large"):
        """Initialize with specified wordlist."""

    def generate(self, word_count: int = 4, separator: str = "-",
                 capitalize: bool = True, custom_wordlist: list[str] | None = None) -> str:
        """Generate passphrase."""

    def load_custom_wordlist(self, path: str) -> list[str]:
        """Load custom wordlist from file."""
```

**Example Output**:
```
correct-horse-battery-staple
Sunlight-Keyboard-Mountain-River
dolphin@tower@garden@sunset
```

#### 4. Pattern Generator (`pattern.py`)

**Purpose**: Template-based generation with custom patterns.

**Features**:
- Template-based generation with patterns like "Cvvc-9999-Cvvc"
- Character class definitions:
  - `C` = consonant
  - `V` = vowel
  - `L` = letter (any)
  - `D` = digit
  - `S` = special character
  - `[abc]` = custom character set
- Validates patterns before generation

**API**:
```python
class PatternGenerator(BaseGenerator):
    """Pattern-based password generator."""

    def generate(self, pattern: str) -> str:
        """Generate password matching pattern."""

    def validate_pattern(self, pattern: str) -> bool:
        """Validate pattern syntax."""

    def get_pattern_length(self, pattern: str) -> int:
        """Calculate final password length from pattern."""
```

**Example Patterns**:
```
Cvvc-9999-Cvvc    â†’ Tare-8472-Mobi
LLLL-DD-LLLL      â†’ XyPq-73-MnOp
[aeiou]999[AEIOU] â†’ e847I
SSS-LLL-DDD       â†’ !@#-xyz-123
```

#### 5. Generator Registry (`registry.py`)

**Purpose**: Central registry managing all generator types.

**Features**:
- Dynamic generator discovery
- Maps CLI type names to generator classes
- Allows future plugin architecture

**API**:
```python
class GeneratorRegistry:
    """Central registry for all password generators."""

    def register(self, name: str, generator_class: type):
        """Register a generator."""

    def get(self, name: str) -> BaseGenerator:
        """Get generator by name."""

    def list_generators(self) -> list[str]:
        """List all registered generator names."""

# Global registry
registry = GeneratorRegistry()
registry.register("normal", SyllableGenerator)
registry.register("strong", SyllableGenerator)
registry.register("super_strong", SyllableGenerator)
registry.register("passphrase", PassphraseGenerator)
registry.register("pattern", PatternGenerator)
```

### Backward Compatibility Strategy

- CLI's `-t normal|strong|super_strong` maps to syllable generator
- New types like `-t passphrase`, `-t pattern:Cvvc-999` are additive
- Existing Python API `Clinkey()` class preserved as alias to syllable generator
- Default behaviors maintained

---

## Password Vault

### Module Structure: `clinkey_cli/vault/`

A secure, local-only password management system integrated into the CLI.

### Core Components

#### 1. Vault Storage (`storage.py`)

**Purpose**: Encrypted SQLite database for secure password storage.

**Features**:
- Encrypted SQLite database using Fernet (symmetric encryption)
- Master password with PBKDF2 key derivation (600,000+ iterations)
- Database location: `~/.clinkey/vault.db`
- Automatic encrypted backups to `~/.clinkey/backups/`
- Secure password hashing for master password verification

**API**:
```python
class VaultStorage:
    """Encrypted password storage."""

    def __init__(self, db_path: str, master_password: str):
        """Initialize vault with master password."""

    def unlock(self, master_password: str) -> bool:
        """Unlock vault with master password."""

    def lock(self):
        """Lock vault and clear encryption key from memory."""

    def is_locked(self) -> bool:
        """Check if vault is locked."""

    def encrypt(self, plaintext: str) -> bytes:
        """Encrypt data with Fernet."""

    def decrypt(self, ciphertext: bytes) -> str:
        """Decrypt data with Fernet."""
```

#### 2. Password Entry Model (`models.py`)

**Purpose**: Data models for password entries.

**Entry Schema**:
- `id`: Unique identifier
- `password`: Encrypted password
- `title`: Entry title/name
- `username`: Associated username
- `url`: Associated URL
- `notes`: Additional notes
- `category`: Category name
- `tags`: List of tags (JSON)
- `created_at`: Creation timestamp
- `updated_at`: Last modification timestamp
- `last_accessed`: Last access timestamp
- `generation_params`: How it was generated (JSON metadata)
- `strength_score`: Security score (0-100)
- `is_compromised`: Breach status

**API**:
```python
from dataclasses import dataclass
from datetime import datetime

@dataclass
class PasswordEntry:
    """Password vault entry model."""
    id: int | None
    title: str
    password: str  # Plaintext in memory, encrypted in DB
    username: str | None = None
    url: str | None = None
    notes: str | None = None
    category: str = "Other"
    tags: list[str] | None = None
    created_at: datetime | None = None
    updated_at: datetime | None = None
    last_accessed: datetime | None = None
    generation_params: dict | None = None
    strength_score: int | None = None
    is_compromised: bool = False
```

#### 3. Vault Operations (`operations.py`)

**Purpose**: CRUD operations for password management.

**Features**:
- CRUD operations: add, get, update, delete
- Search and filter by: title, category, tags, date ranges
- List with sorting options (date, title, category)
- Bulk operations (export, import, backup)
- Password validation before storage

**API**:
```python
class VaultOperations:
    """Password vault operations."""

    def __init__(self, storage: VaultStorage):
        """Initialize with vault storage."""

    def add(self, entry: PasswordEntry) -> int:
        """Add new password entry, returns ID."""

    def get(self, entry_id: int) -> PasswordEntry:
        """Get password entry by ID."""

    def update(self, entry: PasswordEntry) -> bool:
        """Update existing entry."""

    def delete(self, entry_id: int) -> bool:
        """Delete entry by ID."""

    def list(self, category: str | None = None,
             sort_by: str = "created_at") -> list[PasswordEntry]:
        """List entries with optional filtering."""

    def search(self, query: str) -> list[PasswordEntry]:
        """Search entries by title, username, URL, notes."""

    def get_by_category(self, category: str) -> list[PasswordEntry]:
        """Get all entries in category."""

    def get_by_tags(self, tags: list[str]) -> list[PasswordEntry]:
        """Get entries matching tags."""
```

#### 4. Category Manager (`categories.py`)

**Purpose**: Organize passwords into categories.

**Features**:
- Predefined categories: Personal, Work, Finance, Social, Development, Other
- Custom category creation
- Category-based organization and filtering
- Category statistics (count, average age)

**API**:
```python
class CategoryManager:
    """Password category management."""

    def create_category(self, name: str, description: str = "",
                       color: str = "white") -> int:
        """Create new category."""

    def list_categories(self) -> list[dict]:
        """List all categories with stats."""

    def get_category_stats(self, category: str) -> dict:
        """Get statistics for category."""

    def rename_category(self, old_name: str, new_name: str) -> bool:
        """Rename category."""

    def delete_category(self, name: str, move_to: str = "Other") -> bool:
        """Delete category, move entries to another."""
```

#### 5. Import/Export (`io.py`)

**Purpose**: Import/export functionality for migration and backup.

**Export Formats**:
- JSON (full metadata)
- CSV (compatibility)
- Encrypted backup format

**Import From**:
- JSON
- CSV
- 1Password (1PIF)
- LastPass (CSV)
- KeePass (CSV)

**API**:
```python
class VaultIO:
    """Import/export operations."""

    def export_json(self, output_path: str, entries: list[PasswordEntry]):
        """Export to JSON with full metadata."""

    def export_csv(self, output_path: str, entries: list[PasswordEntry]):
        """Export to CSV for compatibility."""

    def export_encrypted_backup(self, output_path: str):
        """Create encrypted backup."""

    def import_json(self, input_path: str) -> list[PasswordEntry]:
        """Import from JSON."""

    def import_csv(self, input_path: str) -> list[PasswordEntry]:
        """Import from CSV."""

    def import_1password(self, input_path: str) -> list[PasswordEntry]:
        """Import from 1Password 1PIF format."""

    def import_lastpass(self, input_path: str) -> list[PasswordEntry]:
        """Import from LastPass CSV export."""

    def import_keepass(self, input_path: str) -> list[PasswordEntry]:
        """Import from KeePass CSV export."""
```

#### 6. Vault CLI Commands (`cli.py`)

**Purpose**: CLI interface for vault operations.

**Commands**:
- `vault init` - Initialize new vault
- `vault add` - Add password interactively
- `vault list` - List all entries
- `vault get <id>` - Get specific entry
- `vault search <query>` - Search entries
- `vault delete <id>` - Delete entry
- `vault export <file>` - Export vault
- `vault import <file>` - Import passwords
- `vault backup` - Manual backup

### Security Features

- Master password never stored (only hash)
- Automatic vault locking after inactivity
- Clipboard auto-clear after copy
- No plaintext password logs
- Encrypted backups
- PBKDF2 key derivation with 600,000+ iterations

---

## Textual TUI Layer

### Module Structure: `clinkey_cli/tui/`

Modern, interactive terminal interfaces built on Textual, complementing the existing CLI commands.

### Core Components

#### 1. Vault Browser (`vault_browser.py`)

**Purpose**: Full-screen TUI for vault management.

**Layout**:
- Sidebar: Categories
- Main panel: Password list
- Detail view: Selected entry
- Status bar: Help hints

**Keyboard Navigation**:
- Vim-style: `j`/`k` for up/down
- `Enter` to view entry
- `d` to delete
- `/` for search
- `q` to quit

**Features**:
- Live search filtering
- Multi-select for bulk operations
- Password visibility toggle
- Quick copy to clipboard

**API**:
```python
class VaultBrowser(App):
    """Textual TUI for vault browsing."""

    def __init__(self, vault_ops: VaultOperations):
        """Initialize with vault operations."""

    def compose(self) -> ComposeResult:
        """Compose TUI layout."""
        yield Header()
        yield Container(
            Sidebar(categories),
            PasswordList(entries),
            DetailView(selected)
        )
        yield Footer()

    def action_search(self):
        """Trigger search mode."""

    def action_delete(self):
        """Delete selected entry."""

    def action_copy(self):
        """Copy password to clipboard."""
```

#### 2. Password Generator Screen (`generator.py`)

**Purpose**: Interactive password generation interface.

**Features**:
- Real-time preview as options change
- Live strength meter updating as you type/configure
- Side-by-side comparison of multiple generated passwords
- Template builder with visual feedback
- Option toggles with immediate effect
- "Generate" button creates and optionally saves to vault

**API**:
```python
class GeneratorScreen(App):
    """Interactive password generator TUI."""

    def __init__(self):
        """Initialize generator screen."""

    def compose(self) -> ComposeResult:
        """Compose generator layout."""
        yield OptionsPanel()  # Length, type, etc.
        yield PreviewPanel()  # Live preview
        yield StrengthMeter()  # Real-time analysis
        yield ActionBar()  # Generate, Save, Copy

    def on_option_changed(self, event):
        """Handle option changes, update preview."""

    def action_generate(self):
        """Generate new password."""

    def action_save_to_vault(self):
        """Save generated password to vault."""
```

#### 3. Strength Analyzer (`analyzer.py`)

**Purpose**: Visual password strength display.

**Components**:
- Entropy gauge (bits)
- Strength score (0-100 with color coding)
- Pattern warnings (highlighted issues)
- Breach status indicator
- Compliance checklist (NIST, OWASP)
- Estimated crack time with attacker scenarios
- Detailed breakdown in expandable sections

**API**:
```python
class StrengthAnalyzer(App):
    """Password strength analysis TUI."""

    def __init__(self, password: str):
        """Initialize with password to analyze."""

    def compose(self) -> ComposeResult:
        """Compose analyzer layout."""
        yield EntropyGauge(entropy)
        yield StrengthScore(score, label)
        yield PatternWarnings(patterns)
        yield BreachStatus(is_breached)
        yield ComplianceChecklist(compliance)
        yield CrackTimeEstimate(estimates)

    def analyze(self, password: str):
        """Perform full analysis and update display."""
```

#### 4. Template Designer (`templates.py`)

**Purpose**: Visual pattern builder for pattern generator.

**Features**:
- Visual pattern builder interface
- Live preview of generated samples
- Save/load templates
- Template library browser
- Export templates to share

**API**:
```python
class TemplateDesigner(App):
    """Pattern template designer TUI."""

    def __init__(self):
        """Initialize template designer."""

    def compose(self) -> ComposeResult:
        """Compose designer layout."""
        yield PatternBuilder()  # Drag-and-drop interface
        yield LivePreview()  # Sample passwords
        yield TemplateLibrary()  # Saved templates
        yield ActionBar()  # Save, Load, Export

    def action_save_template(self, name: str, pattern: str):
        """Save template for reuse."""

    def action_load_template(self, name: str):
        """Load saved template."""
```

#### 5. Dashboard (`dashboard.py`)

**Purpose**: Main TUI entry point.

**Features**:
- Tabbed interface: Generate | Vault | Analyze | Templates
- Quick stats: vault size, recent generations, security scores
- Launches when running `clinkey --tui` or `clinkey tui`

**API**:
```python
class ClinkeyDashboard(App):
    """Main TUI dashboard."""

    def __init__(self):
        """Initialize dashboard."""

    def compose(self) -> ComposeResult:
        """Compose dashboard layout."""
        yield Header(title="Clinkey CLI 2.0")
        yield TabbedContent(
            TabPane("Generate", GeneratorScreen()),
            TabPane("Vault", VaultBrowser()),
            TabPane("Analyze", StrengthAnalyzer()),
            TabPane("Templates", TemplateDesigner()),
        )
        yield Footer()
```

#### 6. Common Widgets (`widgets.py`)

**Purpose**: Reusable components for consistent UI.

**Widgets**:
- `StrengthMeter` - Progress bar + label
- `PasswordDisplay` - Masked/unmasked toggle
- `CategorySelector` - Category dropdown
- `DateRangePicker` - Date filtering
- `ConfirmDialog` - Confirmation prompts

**API**:
```python
class StrengthMeter(Widget):
    """Reusable strength meter widget."""

    def __init__(self, score: int):
        """Initialize with strength score."""

    def update_score(self, score: int):
        """Update displayed score."""

class PasswordDisplay(Widget):
    """Password display with mask/unmask toggle."""

    def __init__(self, password: str, masked: bool = True):
        """Initialize with password."""

    def toggle_visibility(self):
        """Toggle between masked and visible."""
```

### Integration with Existing CLI

- TUI mode is optional and additive
- Original Rich-based interactive mode (`clinkey` with no args) still works
- New flag: `clinkey --tui` launches Textual dashboard
- All TUI features also available via standard CLI commands

---

## CLI Command Structure

### Backward Compatible Commands

**All existing 1.x commands work identically:**

```bash
# Interactive mode (Rich-based) - unchanged
clinkey

# Generate passwords - unchanged
clinkey -l 20 -t strong
clinkey -l 16 -t normal -n 5
clinkey -l 24 --no-sep --lower -o out.txt

# All existing flags work identically
clinkey -l 20 -t super_strong --lower -n 10
```

### New Generation Types

**Extended `-t/--type` options (additive):**

```bash
# New generator types
clinkey -t passphrase                # Generate word-based passphrase
clinkey -t passphrase -l 5           # 5-word passphrase
clinkey -t pattern:Cvvc-999-Cvvc     # Pattern-based generation
clinkey -t syllable:french           # French syllables
clinkey -t syllable:spanish -l 20    # Spanish syllables, 20 chars
```

### Security Analysis Commands

**New `analyze` subcommand:**

```bash
# Analyze any password
clinkey analyze "MyPassword123"      # Full security analysis
clinkey analyze -f passwords.txt     # Analyze file of passwords
clinkey analyze --check-breach       # Include breach check
clinkey analyze --compliance nist    # NIST compliance report
clinkey analyze --json               # JSON output for scripting
```

### Vault Commands

**New `vault` subcommand group:**

```bash
# Vault initialization
clinkey vault init                   # Initialize vault (first time)

# Add passwords
clinkey vault add                    # Add password interactively
clinkey vault add -t "GitHub" -u "user@example.com" -p "password"

# List and search
clinkey vault list                   # List all entries
clinkey vault list --category Work   # Filter by category
clinkey vault search "github"        # Search entries

# Retrieve and manage
clinkey vault get 42                 # Get entry by ID
clinkey vault delete 42              # Delete entry
clinkey vault update 42 -t "New Title"  # Update entry

# Import/Export
clinkey vault export vault.json      # Export vault
clinkey vault import lastpass.csv    # Import from LastPass
clinkey vault backup                 # Manual backup
```

### TUI Mode

**New interactive dashboard:**

```bash
# Launch Textual TUI
clinkey --tui                        # Full dashboard
clinkey tui                          # Alias for --tui

# Direct to specific TUI screen
clinkey vault browse                 # Direct to vault browser
clinkey generate --interactive       # Interactive generator
```

### Combined Workflows

**Generate and analyze/store in one command:**

```bash
# Generate with immediate analysis
clinkey -l 20 -t strong --analyze    # Generate + show strength

# Generate and save to vault
clinkey -l 24 -t passphrase --save-vault --title "Email Password"

# Batch generate with quality filter
clinkey -n 10 --min-strength 80      # Only passwords scoring â‰¥80
```

### Complete Command Reference

```
clinkey [OPTIONS] [COMMAND]

Options:
  -l, --length INTEGER         Password length (default: 16)
  -t, --type TEXT              Password type (normal, strong, super_strong,
                               passphrase, pattern:PATTERN, syllable:LANGUAGE)
  -n, --number INTEGER         Number of passwords to generate
  -o, --output PATH            Output file path
  --lower                      Lowercase output
  --no-sep                     No separators
  -s, --separator TEXT         Custom separator
  --analyze                    Show strength analysis after generation
  --save-vault                 Save to vault after generation
  --title TEXT                 Title when saving to vault
  --min-strength INTEGER       Minimum strength score (0-100)
  --tui                        Launch interactive TUI
  --version                    Show version
  --help                       Show help message

Commands:
  analyze      Analyze password strength
  vault        Password vault management
  config       Configuration management
  tui          Launch interactive TUI (same as --tui flag)
```

---

## Configuration System

### Configuration File: `~/.clinkey/config.toml`

A flexible configuration system for user preferences, vault settings, and security policies.

### Configuration Structure

```toml
[general]
default_length = 16
default_type = "normal"
interactive_mode = "rich"  # "rich" or "tui"
auto_analyze = false       # Auto-analyze generated passwords
clipboard_timeout = 30     # Seconds before auto-clear

[security]
min_password_length = 16
max_password_length = 128
min_strength_score = 0     # 0-100, reject if below
check_breaches = false     # Auto-check breach database
offline_breach_db = "~/.clinkey/breaches.db"

[vault]
database_path = "~/.clinkey/vault.db"
backup_path = "~/.clinkey/backups/"
auto_backup = true
backup_interval = 7        # Days
lock_timeout = 300         # Seconds (5 min)
clipboard_clear = true

[generators.syllable]
default_language = "english"
complexity = "mixed"       # "simple", "complex", "mixed"

[generators.passphrase]
default_wordlist = "eff_large"
default_word_count = 4
separator = "-"
capitalize = true

[generators.pattern]
saved_templates = []       # User's saved patterns

[compliance]
enforce_nist = false
enforce_owasp = false
custom_policies = []

[ui.tui]
theme = "dark"            # "dark" or "light"
vim_mode = true
show_help_bar = true

[ui.rich]
color_scheme = "default"  # Preserve current colors
```

### Configuration Management

**Configuration commands:**

```bash
# Configuration commands
clinkey config init                  # Create default config
clinkey config show                  # Display current config
clinkey config set general.default_length 20
clinkey config get vault.lock_timeout
clinkey config reset                 # Reset to defaults
clinkey config edit                  # Open in $EDITOR
```

### Loading Priority

1. Command-line flags (highest priority)
2. Environment variables (`CLINKEY_*`)
3. User config file (`~/.clinkey/config.toml`)
4. System defaults (lowest priority)

### Backward Compatibility

- If no config file exists, use 1.x defaults
- Config is optional - CLI works without it
- All settings have sensible defaults

---

## Data Models and Database Schema

### Vault Database Schema

**SQLite with encryption (SQLCipher or application-level Fernet)**

#### Table: `passwords`

Core password storage:

```sql
CREATE TABLE passwords (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title TEXT NOT NULL,
    username TEXT,
    password_encrypted BLOB NOT NULL,  -- Fernet encrypted
    url TEXT,
    notes TEXT,
    category TEXT DEFAULT 'Other',
    tags TEXT,  -- JSON array
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_accessed TIMESTAMP,
    generation_params TEXT,  -- JSON metadata
    strength_score INTEGER,
    is_compromised BOOLEAN DEFAULT 0
);

CREATE INDEX idx_category ON passwords(category);
CREATE INDEX idx_created ON passwords(created_at);
CREATE INDEX idx_title ON passwords(title);
```

#### Table: `password_history`

Immutable audit trail:

```sql
CREATE TABLE password_history (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    password_id INTEGER NOT NULL,
    old_password_encrypted BLOB NOT NULL,
    changed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    change_reason TEXT,
    FOREIGN KEY (password_id) REFERENCES passwords(id) ON DELETE CASCADE
);
```

#### Table: `categories`

Custom categories:

```sql
CREATE TABLE categories (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT UNIQUE NOT NULL,
    description TEXT,
    color TEXT,  -- For TUI display
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Prepopulated with defaults
INSERT INTO categories (name, description, color) VALUES
    ('Personal', 'Personal accounts', 'blue'),
    ('Work', 'Work-related passwords', 'green'),
    ('Finance', 'Banking and financial', 'yellow'),
    ('Social', 'Social media accounts', 'magenta'),
    ('Development', 'Dev tools and services', 'cyan'),
    ('Other', 'Miscellaneous', 'white');
```

#### Table: `vault_metadata`

Vault configuration:

```sql
CREATE TABLE vault_metadata (
    key TEXT PRIMARY KEY,
    value TEXT NOT NULL
);

-- Stores: schema_version, created_at, last_backup, master_password_hash
```

### Python Models

**File: `clinkey_cli/vault/models.py`**

```python
from dataclasses import dataclass
from datetime import datetime
from typing import Optional

@dataclass
class PasswordEntry:
    """Password vault entry model."""
    id: Optional[int]
    title: str
    password: str  # Plaintext in memory, encrypted in DB
    username: Optional[str] = None
    url: Optional[str] = None
    notes: Optional[str] = None
    category: str = "Other"
    tags: list[str] = None
    created_at: Optional[datetime] = None
    updated_at: Optional[datetime] = None
    last_accessed: Optional[datetime] = None
    generation_params: Optional[dict] = None
    strength_score: Optional[int] = None
    is_compromised: bool = False
```

### Encryption Strategy

**Master Password â†’ Encryption Key:**

1. Master password â†’ PBKDF2 (600k iterations, SHA256) â†’ 32-byte key
2. Key used for Fernet symmetric encryption
3. Each password encrypted individually
4. Encryption key derived fresh on vault unlock
5. Key stored in memory only during session

**Security Properties:**

- Master password never stored (only hash)
- Brute force protection via PBKDF2 iterations
- Forward secrecy: old backups can't be decrypted with new key
- Memory protection: key cleared on lock

---

## Security Implementation Specifics

### Strength Scoring Algorithm

**Composite score (0-100):**

The overall strength score combines multiple factors:

#### 1. Entropy Component (40 points max)

- Calculate Shannon entropy: `H = -Î£(p(x) * logâ‚‚(p(x)))`
- Calculate character set entropy: `logâ‚‚(charset_size^length)`
- Score = `min(40, entropy / 3)`  # ~120 bits = full points

#### 2. Length Component (20 points max)

- < 12 chars: 0 points
- 12-15 chars: 10 points
- 16-19 chars: 15 points
- â‰¥ 20 chars: 20 points

#### 3. Complexity Component (20 points max)

- Has lowercase: +4 points
- Has uppercase: +4 points
- Has digits: +4 points
- Has specials: +4 points
- Character diversity ratio: +4 points

#### 4. Pattern Penalty (0 to -30 points)

- Keyboard walk detected: -10 points
- Sequential chars (3+): -5 points
- Repeated chars (3+): -5 points
- Common substitutions only: -5 points
- Date/phone patterns: -5 points

#### 5. Dictionary Penalty (0 to -30 points)

- In top 10k list: -30 points
- In top 100k list: -20 points
- In top 1M list: -10 points
- Contains dictionary word: -5 points

#### 6. Breach Penalty (-50 points)

- Found in breach database: -50 points (critical)

**Final Score**: Sum all components, clamp to 0-100.

### Strength Labels

- **0-39**: "Weak" (red)
- **40-69**: "Moderate" (yellow)
- **70-84**: "Strong" (green)
- **85-100**: "Very Strong" (bright green)

### Implementation

```python
def calculate_strength_score(password: str,
                            check_breach: bool = False) -> dict:
    """Calculate comprehensive strength score."""

    score = 0
    details = {}

    # 1. Entropy (max 40 points)
    entropy = calculate_entropy(password)
    entropy_score = min(40, entropy / 3)
    score += entropy_score
    details["entropy"] = {"bits": entropy, "score": entropy_score}

    # 2. Length (max 20 points)
    length = len(password)
    if length >= 20:
        length_score = 20
    elif length >= 16:
        length_score = 15
    elif length >= 12:
        length_score = 10
    else:
        length_score = 0
    score += length_score
    details["length"] = {"chars": length, "score": length_score}

    # 3. Complexity (max 20 points)
    complexity_score = calculate_complexity(password)
    score += complexity_score
    details["complexity"] = {"score": complexity_score}

    # 4. Pattern penalties (max -30 points)
    pattern_penalty = detect_patterns(password)
    score -= pattern_penalty
    details["patterns"] = {"penalty": pattern_penalty}

    # 5. Dictionary penalties (max -30 points)
    dict_penalty = check_dictionary(password)
    score -= dict_penalty
    details["dictionary"] = {"penalty": dict_penalty}

    # 6. Breach penalty (-50 points)
    if check_breach:
        is_breached = check_breach_database(password)
        if is_breached:
            score -= 50
            details["breach"] = {"found": True, "penalty": 50}

    # Clamp score to 0-100
    final_score = max(0, min(100, score))

    # Determine label
    if final_score >= 85:
        label = "Very Strong"
        color = "bright_green"
    elif final_score >= 70:
        label = "Strong"
        color = "green"
    elif final_score >= 40:
        label = "Moderate"
        color = "yellow"
    else:
        label = "Weak"
        color = "red"

    return {
        "score": final_score,
        "label": label,
        "color": color,
        "details": details
    }
```

---

## Dependencies and Technology Stack

### New Dependencies for 2.0

**Required dependencies:**

```toml
[project.dependencies]
# Existing (1.x)
click = ">=8.3.0"
rich = ">=14.1.0"

# New for 2.0
textual = ">=0.50.0"           # TUI framework
cryptography = ">=42.0.0"      # Fernet encryption, PBKDF2
zxcvbn-python = ">=4.4.0"      # Context-aware password strength
httpx = ">=0.27.0"             # Breach API checks (async)
toml = ">=0.10.2"              # Config file parsing
```

### Optional Dependencies

```toml
[project.optional-dependencies]
# Development tools (existing + additions)
dev = [
    "pytest>=8.0.0",
    "pytest-cov>=4.1.0",
    "pytest-asyncio>=0.23.0",  # New: async tests
    "pytest-mock>=3.12.0",
    "hypothesis>=6.92.0",
    "black>=24.0.0",
    "isort>=5.13.0",
    "flake8>=7.0.0",
    "mypy>=1.8.0",
    "pylint>=3.0.0",
    "bandit>=1.7.0",
    "pip-audit>=2.6.0",
]

# SQLCipher for hardware-level encryption (optional)
sqlcipher = [
    "sqlcipher3>=0.5.0",
]

# Offline breach database support
breach-db = [
    "requests>=2.31.0",        # Download breach databases
]
```

### Rationale for Each New Dependency

1. **textual** - Official Rich TUI framework
   - Same maintainers as current Rich UI
   - Modern reactive architecture
   - Excellent documentation

2. **cryptography** - Industry-standard crypto library
   - Fernet for symmetric encryption
   - PBKDF2 for key derivation
   - Actively maintained by PyCA

3. **zxcvbn-python** - Port of Dropbox's zxcvbn library
   - Context-aware password strength estimation
   - Realistic attack modeling

4. **httpx** - Modern async HTTP client
   - Needed for breach API calls
   - Better async support than requests

5. **toml** - Standard TOML parsing
   - Lightweight config format
   - Human-readable

### Dependency Philosophy

- Minimal new dependencies
- Prefer stdlib when possible (sqlite3, hashlib, secrets)
- All new deps serve critical features
- No heavy frameworks (no Django, Flask, etc.)

---

## Testing Strategy

### Test Coverage Goals

- **Overall**: â‰¥85%
- **Critical modules**: â‰¥95% (security, vault, crypto)

### Test Structure

```
tests/
â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ test_entropy.py           # Entropy calculations
â”‚   â”œâ”€â”€ test_patterns.py          # Pattern detection
â”‚   â”œâ”€â”€ test_dictionary.py        # Dictionary matching
â”‚   â”œâ”€â”€ test_breach.py            # Breach checking (mocked)
â”‚   â”œâ”€â”€ test_context.py           # Context analysis
â”‚   â”œâ”€â”€ test_compliance.py        # NIST/OWASP validation
â”‚   â”œâ”€â”€ test_syllable_gen.py      # Syllable generator
â”‚   â”œâ”€â”€ test_passphrase_gen.py    # Passphrase generator
â”‚   â”œâ”€â”€ test_pattern_gen.py       # Pattern generator
â”‚   â”œâ”€â”€ test_vault_storage.py     # Vault encryption/decryption
â”‚   â”œâ”€â”€ test_vault_operations.py  # CRUD operations
â”‚   â”œâ”€â”€ test_models.py            # Data models
â”‚   â””â”€â”€ test_config.py            # Configuration system
â”œâ”€â”€ integration/
â”‚   â”œâ”€â”€ test_cli_backward_compat.py  # 1.x command compatibility
â”‚   â”œâ”€â”€ test_generate_analyze.py     # Generate + analyze workflow
â”‚   â”œâ”€â”€ test_generate_vault.py       # Generate + save workflow
â”‚   â”œâ”€â”€ test_vault_cli.py            # Vault CLI commands
â”‚   â”œâ”€â”€ test_tui_vault.py            # TUI vault browser
â”‚   â””â”€â”€ test_import_export.py        # Import/export formats
â”œâ”€â”€ security/
â”‚   â”œâ”€â”€ test_encryption.py        # Crypto implementation
â”‚   â”œâ”€â”€ test_key_derivation.py    # PBKDF2 parameters
â”‚   â”œâ”€â”€ test_vault_security.py    # Vault attack scenarios
â”‚   â””â”€â”€ test_breach_privacy.py    # k-anonymity model
â”œâ”€â”€ fixtures/
â”‚   â”œâ”€â”€ sample_passwords.py       # Test password corpus
â”‚   â”œâ”€â”€ wordlists.py              # Test wordlists
â”‚   â””â”€â”€ breach_data.py            # Mock breach database
â””â”€â”€ conftest.py                   # Shared fixtures
```

### Key Testing Approaches

#### 1. Backward Compatibility Tests

- Snapshot testing for 1.x commands
- Ensure exact output matching for existing flags
- Python API compatibility tests
- Regression test suite from 1.x

#### 2. Security Property Testing

- Use Hypothesis for property-based tests
- Entropy is monotonically increasing with length
- All generated passwords meet minimum strength
- Encryption/decryption round-trips correctly
- No plaintext passwords in vault file

#### 3. Cryptographic Testing

- Mock external APIs (breach checks)
- Verify PBKDF2 iteration count (â‰¥600k)
- Test key derivation consistency
- Vault corruption resistance
- Backup integrity validation

#### 4. TUI Testing

- Textual has built-in testing support
- Snapshot testing for screen layouts
- Keyboard interaction simulation
- Accessibility testing (screen reader compat)

#### 5. Performance Testing

- Batch generation benchmarks (500 passwords < 5s)
- Vault query performance (1000 entries < 100ms)
- Strength analysis speed (< 50ms per password)
- Startup time regression tests

### Security Audit Requirements

- Pre-release security audit with Bandit
- Dependency vulnerability scanning (pip-audit)
- Manual code review of crypto code
- OWASP testing guidelines for password tools

---

## Migration and Upgrade Path

### Zero-Friction Upgrade Strategy

Users should be able to upgrade seamlessly.

### Installation Upgrade

```bash
# PyPI upgrade
pip install --upgrade clinkey-cli

# Homebrew upgrade
brew upgrade clinkey-cli

# First run after upgrade
clinkey --version  # Shows 2.0.0
clinkey             # Works exactly as before (Rich UI)
```

### First-Time 2.0 Setup

When a user first runs 2.0, clinkey detects it's a new major version:

```
$ clinkey

Welcome to Clinkey 2.0! ðŸŽ‰

New features available:
  â€¢ Advanced password strength analysis
  â€¢ Password vault for secure storage
  â€¢ New generation types (passphrases, patterns, languages)
  â€¢ Interactive TUI mode

Would you like to:
  1. Continue with classic mode (same as 1.x)
  2. Quick setup (initialize config and vault)
  3. Learn about new features

Choice (1/2/3): _
```

### Configuration Migration

No migration needed - 2.0 creates config on first use:

```bash
# Optional: Initialize with preferences
clinkey config init --interactive

# Or use defaults
clinkey config init --defaults
```

### Vault Initialization

Vault is opt-in - users must explicitly initialize:

```bash
# First vault use
$ clinkey vault init
Create master password: ********
Confirm master password: ********
âœ“ Vault initialized at ~/.clinkey/vault.db
```

### Compatibility Guarantees

#### 1. CLI Commands

- All 1.x commands produce identical output
- All flags work unchanged
- Exit codes preserved
- Output format unchanged (unless using new features)

#### 2. Python API

- `from clinkey_cli.main import Clinkey` works unchanged
- `clinkey.generate_password()` signature preserved
- Default behaviors maintained
- New parameters are optional with safe defaults

#### 3. File Formats

- Output files (`-o` flag) format unchanged
- Existing scripts continue to work
- Pipe/redirect compatibility maintained

### Testing Compatibility

Automated test suite verifies:
- 100+ 1.x command scenarios
- Python API call patterns
- Output format matching
- Exit code consistency

### Rollback Strategy

If users need to rollback:

```bash
pip install clinkey-cli==1.2.0  # PyPI
brew unlink clinkey-cli && brew install clinkey-cli@1.2  # Homebrew
```

**Note**: Vault data is forward-compatible only (2.0 can't downgrade vault to 1.x, but vault is 2.0-only feature anyway).

---

## Implementation Phasing

### Phased Development Strategy

Build incrementally with working software at each phase.

### Phase 1: Foundation (Weeks 1-3)

**Goals**:
- Refactor existing code into new module structure
- Set up `clinkey_cli/generators/` with base classes
- Migrate current Clinkey class to SyllableGenerator
- Ensure 100% backward compatibility tests pass
- Set up configuration system skeleton

**Deliverable**: `2.0.0-alpha.1` with refactored architecture

### Phase 2: Security Engine (Weeks 4-7)

**Goals**:
- Implement entropy calculator
- Build pattern detector
- Create dictionary analyzer with word lists
- Implement breach checker (with mocked API initially)
- Build context analyzer (zxcvbn-style)
- Add compliance validators
- Integrate `clinkey analyze` command

**Deliverable**: `2.0.0-alpha.2` with full security analysis

### Phase 3: Enhanced Generators (Weeks 8-10)

**Goals**:
- Implement passphrase generator with EFF wordlists
- Build pattern generator with template parser
- Add multi-language syllable sets
- Create generator registry
- Extend CLI with new `-t` options

**Deliverable**: `2.0.0-beta.1` with all generators

### Phase 4: Password Vault (Weeks 11-14)

**Goals**:
- Implement encryption layer (Fernet)
- Build SQLite database schema
- Create CRUD operations
- Implement import/export functionality
- Add `clinkey vault` CLI commands
- Build category management

**Deliverable**: `2.0.0-beta.2` with vault functionality

### Phase 5: TUI Layer (Weeks 15-18)

**Goals**:
- Set up Textual framework
- Build vault browser TUI
- Create interactive generator screen
- Implement strength analyzer display
- Add template designer
- Build main dashboard

**Deliverable**: `2.0.0-rc.1` with complete TUI

### Phase 6: Polish & Release (Weeks 19-20)

**Goals**:
- Comprehensive testing (all test suites)
- Security audit
- Documentation completion
- Performance optimization
- Bug fixes from beta testing
- Final backward compatibility verification

**Deliverable**: `2.0.0` stable release

### Development Workflow Per Feature

1. **TDD Approach**
   - Write tests first
   - Implement minimal code to pass
   - Refactor for quality

2. **Code Review Gates**
   - Each phase requires code review
   - Security review for crypto/vault code
   - Performance benchmarks

3. **Incremental Testing**
   - Unit tests per module
   - Integration tests per phase
   - Full regression suite before each deliverable

---

## Documentation Plan

### Documentation Structure

```
docs/
â”œâ”€â”€ user-guide/
â”‚   â”œâ”€â”€ getting-started.md        # Quick start guide
â”‚   â”œâ”€â”€ installation.md           # Install via pip/brew
â”‚   â”œâ”€â”€ basic-usage.md            # 1.x compatible commands
â”‚   â”œâ”€â”€ generators.md             # All generation types
â”‚   â”œâ”€â”€ security-analysis.md      # Using analyze command
â”‚   â”œâ”€â”€ vault-guide.md            # Vault management
â”‚   â”œâ”€â”€ tui-guide.md              # Using interactive TUI
â”‚   â””â”€â”€ configuration.md          # Config file reference
â”œâ”€â”€ reference/
â”‚   â”œâ”€â”€ cli-reference.md          # Complete CLI command reference
â”‚   â”œâ”€â”€ api-reference.md          # Python API documentation
â”‚   â”œâ”€â”€ security-metrics.md       # How scoring works
â”‚   â””â”€â”€ compliance.md             # NIST/OWASP requirements
â”œâ”€â”€ guides/
â”‚   â”œâ”€â”€ migration-from-1x.md      # Upgrade guide
â”‚   â”œâ”€â”€ best-practices.md         # Password security tips
â”‚   â”œâ”€â”€ import-export.md          # Manager migration
â”‚   â””â”€â”€ troubleshooting.md        # Common issues
â”œâ”€â”€ development/
â”‚   â”œâ”€â”€ architecture.md           # System design
â”‚   â”œâ”€â”€ contributing.md           # Contribution guide
â”‚   â”œâ”€â”€ testing.md                # Test requirements
â”‚   â””â”€â”€ security.md               # Security considerations
â””â”€â”€ plans/
    â””â”€â”€ 2025-01-26-clinkey-2.0-design.md  # This design doc
```

### README Updates

Updated main `README.md` with:
- Feature highlights for 2.0
- Quick start examples (old + new)
- Security features showcase
- Links to comprehensive docs
- Migration notice for 1.x users

### In-CLI Help

Enhanced help system:

```bash
clinkey --help              # Main help with 2.0 features
clinkey analyze --help      # Analysis options
clinkey vault --help        # Vault commands
clinkey config --help       # Configuration
```

### API Documentation

Full docstrings (NumPy style) for:
- All public classes and methods
- Code examples in docstrings
- Type hints throughout
- Sphinx-generated HTML docs

---

## Release Strategy

### Pre-Release Cycle

#### 1. Alpha Releases (2.0.0-alpha.1, alpha.2)

- For early adopters and testing
- Published to PyPI with pre-release flag
- Documented breaking changes (none expected)
- Feedback collection via GitHub Issues

#### 2. Beta Releases (2.0.0-beta.1, beta.2)

- Feature-complete versions
- Public testing invitation
- Performance benchmarking
- Security audit conducted
- Documentation review

#### 3. Release Candidates (2.0.0-rc.1, rc.2)

- Production-ready candidates
- Final bug fixes only
- Backward compatibility verification
- Migration guide validation

### Stable Release (2.0.0)

**Release checklist:**

- [ ] All tests passing (â‰¥85% coverage)
- [ ] Security audit completed
- [ ] Documentation complete
- [ ] Backward compatibility verified
- [ ] Performance benchmarks met
- [ ] Homebrew formula updated
- [ ] PyPI package published
- [ ] GitHub release with notes
- [ ] Announcement (blog, social media)

### Post-Release

- Monitor GitHub Issues for bug reports
- Patch releases (2.0.1, 2.0.2) as needed
- User feedback collection
- Performance monitoring

### Communication

- Detailed `RELEASE_NOTES.md` (like 1.2.0)
- Migration guide prominence
- Video tutorial (optional)
- Blog post announcing features

---

## Future Considerations

### Not in 2.0, but possible for future versions:

#### 2.1.x - Enhancements

- Additional language support
- More import/export formats
- Custom breach database support
- Shell completion scripts

#### 2.2.x - Integrations

- Browser extension support
- SSH key generation
- API key generation
- Team/shared vaults (local only)

#### 3.0.x - Platform Expansion

- Optional cloud sync (end-to-end encrypted)
- Mobile companion app
- Plugin architecture
- Scripting language support

---

## Appendix

### Key Design Decisions

1. **Security First**: Foundation for all features
2. **Backward Compatibility**: Zero breaking changes
3. **Local-Only Vault**: No cloud dependency
4. **TUI Framework**: Textual (Rich ecosystem)
5. **Encryption**: Fernet + PBKDF2
6. **Password Strength**: zxcvbn-inspired composite scoring

### Success Metrics

- 100% backward compatibility (verified by tests)
- â‰¥85% test coverage
- Security audit passing
- Positive user feedback
- Adoption rate among 1.x users

### Risks and Mitigations

| Risk | Mitigation |
|------|------------|
| Breaking compatibility | Extensive regression testing, snapshot tests |
| Security vulnerabilities | Security audit, crypto library review, peer review |
| Performance degradation | Benchmarking at each phase, profiling |
| Complex user experience | Maintain simple defaults, comprehensive docs |
| Dependency bloat | Minimal dependencies, justify each addition |

---

**Document Status**: Approved for Implementation
**Next Steps**: Begin Phase 1 - Foundation
**Review Date**: After each phase completion
